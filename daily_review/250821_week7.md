# ✅ 1. 리뷰
## 오늘 한 것
### 1. DeadLock 해결
- Batch Job을 동시에 병렬적으로 실행할 때 발생하던 deadlock 해결
- 트랜잭션 격리수준 커스텀

### 2. MySQL bulk update 적용
- DashboardTodayWeather 테이블 동시 수정하는 job에 적용
- 시간 성능 향상 + 동시성 제어 두 마리 토끼 잡음.

## 작업 과정에서 배운 것
### 1. MySQL의 트랜잭션 격리 수준
- MySQL에서 REPEATED_READ와 READ_COMMITTED 차이를 배웠다. 
- 팬텀 Read 개념
- MySQL의 Gap Lock에 대해서 배웠다.

### 2. DB에 쿼리 날리는 건 줄일수록 좋다.
- 3가지 방식을 비교분석해보았다.
- job의 writer에서 각 엔티티 별로 하나씩 쿼리를 날리는 방식
- in을 사용해서 한 번에 읽어오고 한 번에 쓰기
- bulk update 사용하기
- bulk update가 약 3ms 정도로 가장 좋았다. 

## 어려웠던 점
### 1. Batch는 테스트해보기 쉽지 않다. 
- Batch 로직을 수정하고 한 번 테스트 해보기 위해서 돌리는게 너무 번거롭다. 
- 테스트 때마다 cron 표현식 수정해야 하는게 쉽지 않다. 

# 🤔 2. 회고 (KPT)
## Keep (잘한점)
### 1. 성능 개선
- 실행시간을 기존 코드에서 5배나 향상시켰다. 
- 각 코드의 실행시간을 비교해보고 적합한 방식을 선택했다. 
- 합당한 근거를 토대로 의사결정을 했다. 

### 2. Deadlock 해결
- MySQL 동작방식을 세세히 뜯어보았다. 
- 승진님께 MySQL 동작을 물어보았다. 

## Problem (개선할 점)
### 1. 좀 더 깊이 있는 탐구가 필요 
- 당장은 시간이 없기에 대충 이해하고 넘어가도 된다지만 깊이 있게 탐구하는 자세가 필요하다.

## Try (해결책)
- MySQL이나 DB의 동작방식을 더 공부해보자.
- 기업들 기술 블로그 열심히 찾아보자. 

## 자체 평가
나름 열심히 했고, deadlock도 해결하고, bulk update를 적용해서 성능개선도 이루어내었다. 
하루만에 여러 최적화를 한 것 같아 굉장히 뿌듯한 하루다. 

그리고 MySQL을 더 공부해봐야겠다는 생각을 하게 되었다. 기술을 깊게 탐구하는 자세가 필요한 것 같다. 

# 📚 3. 학습 내용

# 💁‍ Todo list
- [x] Deadlock 해결
- [x] DashboardTodayWeather 문제상황 재현해보고 해결하기
- [ ] 단기예보 논리적 오류 해결
- [ ] 배치 실패시 afterStep 안되게 하기
- [ ] Batch 실패했을 때의 Step 정의하기